---
title: "NSW Property - A Case Study"
output:
  html_document:
    toc: true
    toc_float: true
---
```{r echo = FALSE,message =FALSE, warning=FALSE}
library(ggplot2)
library(ggrepel)
library(dplyr)
library(sf)
#library(gridExtra)

data <- readRDS("rmarkdown_data.rds")
units <- readRDS("units.rds")
sydney <- readRDS("map_sydney.rds")
rest <- readRDS("map_rest.rds")
centroid <- readRDS("centroids.rds")

growth_by_sa4 <- data %>%
    filter(year == 2019) %>%
    group_by(sa4_name,gccsa_name) %>%
    summarise(average = mean(index)) 

unit_growth_by_sa4 <- units %>%
    filter(year == 2019) %>%
    group_by(sa4_name,gccsa_name) %>%
    summarise(average = mean(index)) 
```

## Houses - A Story of Growth
The overwhelming sentiment in Australia is that investing in houses is the perfect investment as it doubles every 7 years while at the same time being the safest investment available. These two features are typically considered to be competing forces and are what the Risk/Return tradeoff characterises. But seemingly, in Australia this tradeoff doesn't apply.

<br>

### 1 - A Story of Growth
<br>
If you were looking at buying a house in NSW in the year 2000, you basically couldn't go wrong. Prices weren't outrageous and there hadn't been all that much growth over the proceeding 10 years. Across NSW, the median house price was $`r data %>% filter(year == 2000) %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`. In Sydney, this was a bit higher at $`r data %>% filter(year == 2000) %>% filter(gccsa_name == "Greater Sydney") %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`.

The median return over the next 20 years was `r data %>% filter(year == 2019) %>% summarise(median = median(index)) %>% mutate(median = median -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%, with the absolute worst return being `r data %>% filter(year == 2019) %>% summarise(min = min(index)) %>% mutate(min = min -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`% at `r data %>% filter(year == 2019) %>% arrange(index) %>% select(suburb_name) %>% head(1)`. On the other hand, the average person who bought a house in `r data %>% filter(year == 2019) %>% arrange(desc(index)) %>% select(suburb_name) %>% head(1)`, saw a growth rate of `r data %>% filter(year == 2019) %>% summarise(max = max(index)) %>% mutate(max = max -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%. 

The below graph shows how much of the state grew solidly between 2001 and 2004, plateaued between 2005 and 2009 and then resumed growth from 2009 with takeoff after 2012. Interestingly, these movements coincide strongly with [RBA Cash Rate](https://www.rba.gov.au/statistics/cash-rate/) reductions (between February 2001 and December 2001 the Cash Rate fell 2%, between September 2008 and April 2009 the Cash Rate fell 4.25% and there has been a slow reduction down to 0.75% since November 2011). I've shown reductions in the Cash Rate (i.e. Expansionary Policy) in green and increases (i.e. Contractionary Policy) in red. 

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data,aes(x = year, y = index, group = suburb_name)) + 
    geom_line(alpha = 0.05) +
    ggtitle("Houses - A Story of Growth") +
    theme_minimal() +
    theme(plot.title = element_text(hjust=0.5)) +
    geom_hline(yintercept=100, linetype="dashed", color = "red") + 
    scale_y_continuous(breaks = c(100,500,1000)) + 
    labs(x = "Year", y = "Price Index from year 2000") +
    annotate("rect", xmin=2001.1, xmax=2001.9, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2008.7, xmax=2009.3, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2011.9, xmax=2019, ymin=0, ymax=Inf, alpha=0.1, fill="green") +
    annotate("rect", xmin=2002.4, xmax=2008.3, ymin=0, ymax=Inf, alpha=0.1, fill="red") + 
    annotate("rect", xmin=2009.8, xmax=2010.9, ymin=0, ymax=Inf, alpha=0.1, fill="red")
```

### 2 - Regional NSW Grew First
<br>
The prevailing wisdom regarding property prices seems to be that property prices tend to rise fastest in the Australian capital cities, particularly Sydney and Melbourne. While the data sees this over the last 7 years, the story isn't as strong in the first property boom of this millenium. 

The below graph shows the above data, but splits the state into Greater Sydney and the rest of NSW. What is clear is that initially regional areas grow faster and it is only in the later spurt that Sydney catches up and in some areas surpases the regional growth.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data,aes(x = year, y = index, group = suburb_name, colour = gccsa_name)) + 
      geom_line(alpha = 0.1) +
      scale_y_continuous(breaks = c(100,500,1000)) +
      ggtitle("Regional NSW Moved First") +
      labs(x = "Year", y = "Price Index from year 2000", colour = "Region") +
      theme_minimal()+
      theme(plot.title = element_text(hjust=0.5)) +
      theme(legend.position="bottom") + 
      guides(colour = guide_legend(override.aes = list(alpha = 1)))
```

### 3 - Which Regions Grew the Most?
<br>
The table below shows the average cumulative growth in house prices for all 28 statistical level 4 (SA4) regions of NSW. While the Eastern Suburbs of Sydney are way out ahead of the pack, the average index score for all SA4s has at least doubled from 100 at the start of the year 2000 to over 200 all over the state.

```{r echo = FALSE,message =FALSE, warning=FALSE, fig.width = 3}
  table_1 <- growth_by_sa4 %>%
    rename(SA4 = sa4_name,
           `Average Price Index in 2019` = average,
           `Greater Sydney or Rest of NSW` = gccsa_name) %>%
    arrange(desc(`Average Price Index in 2019`))

  knitr::kable(table_1)
```

Visualising these figures on the map of NSW shows an obvious bias towards coastal regions, but also a slight lull for the coastal regions which are closer to Greater Sydney. This might suggest a preference to either be in the thick of it on Bondi Beach or get away from everything, except the beach. 

```{r echo = FALSE,message =FALSE, warning=FALSE, fig.width=4.2, fig.height=4.2, fig.show = 'hold'}
  rest_growth <- rest %>%
    left_join(growth_by_sa4)
  
  ggplot(rest_growth) +
    geom_sf(mapping = aes(fill = average)) +
    scale_fill_continuous(type = "viridis",limits = c(200,600)) +
    ggtitle("Average Price Index - Rest of NSW") +
    labs(fill = "Average Price Index in 2019") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom", legend.key.width = unit(0.7,"cm"))
  
  sydney_growth <- sydney %>%
    left_join(growth_by_sa4)
  
  ggplot(sydney_growth) +
    geom_sf(mapping = aes(fill = average)) +
    scale_fill_continuous(type = "viridis",limits = c(200,600)) +
    ggtitle("Average Price Index - Greater Sydney") +
    labs(fill = "Average Price Index in 2019") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom", legend.key.width = unit(0.7,"cm"))
  
```

### 4 - Top 10 Regional Suburbs

The next focus is to look more closely at the top 20 suburbs in 2019, which conveniently split into two groups of 10 based on being in Greater Sydney or Regional NSW.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data %>% 
           filter(gccsa_name == "Rest of NSW") %>% 
           arrange(desc(top)) %>%
           head(200),
         aes(x = year, y = index, group = suburb_name, colour = sa4_name)) + 
    geom_line() +
    geom_text_repel(data = data %>% 
                      filter(gccsa_name == "Rest of NSW") %>% 
                      arrange(desc(top)) %>%
                      head(200) %>%
                      group_by(suburb_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = suburb_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,500,1000)) +
    ggtitle("Top 10 - Rest of NSW") +
    labs(x = "Year", y = "Price Index from year 2000", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom") + 
    guides(colour = guide_legend(override.aes = list(alpha = 1)))
```

It's probably not obvious exactly where these suburbs are, so I've shown them on the map. We can now see a cluster of high performing suburbs in Newcastle, as well as a cluster around Byron Bay and near Canberra (as I only have access to NSW data the ACT is not visible, but based on this evidence Canberra might have seen some solid growth over the last 20 years).

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  
top_rest <- data %>%
    filter(year == 2019) %>%
    filter(gccsa_name == "Rest of NSW") %>% 
    arrange(desc(top)) %>%
    head(10)
  
top_rest_points <- centroid %>%
    semi_join(top_rest) %>%
    mutate(x = st_coordinates(geometry)[,1],
           y = st_coordinates(geometry)[,2]) 

ggplot(rest) +
    geom_sf() +
    geom_sf(data = rest %>% filter(sa4_name %in% c("Capital Region",
                                                   "Hunter Valley exc Newcastle",
                                                   "Richmond - Tweed",
                                                   "Coffs Harbour - Grafton",
                                                   "Newcastle and Lake Macquarie",
                                                   "Riverina")),
            mapping = aes(fill = sa4_name)) +
    geom_point(data = top_rest_points,mapping = aes(x,y), colour = "red") +
    geom_label_repel(data = top_rest_points,
                     mapping = aes(x,y,label = suburb_name),
                     size = 2.5) +
    ggtitle("Top 10 - Rest of NSW") +
    labs(fill = "SA4") +
    theme_minimal() +
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom",
          axis.title.x=element_blank(),
          axis.title.y=element_blank())
```

### 5 - Top 10 Greater Sydney Suburbs

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data %>% 
           filter(gccsa_name == "Greater Sydney") %>% 
           arrange(desc(top)) %>%
           head(200),
         aes(x = year, y = index, group = suburb_name, colour = sa4_name)) + 
    geom_line() +
    geom_text_repel(data = data %>% 
                      filter(gccsa_name == "Greater Sydney") %>% 
                      arrange(desc(top)) %>%
                      head(200) %>%
                      group_by(suburb_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = suburb_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,500,1000)) +
    ggtitle("Top 10 - Greater Sydney") +
    labs(x = "Year", y = "Price Index from year 2000", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom") + 
    guides(colour = guide_legend(override.aes = list(alpha = 1),
                                 nrow=2,byrow=TRUE))
```

Unsurprisingly, a number of suburbs in the Eastern Suburbs of Sydney feature in the top 10 best performing since 2000, but it is pretty hard to see anything here as the highly performing suburbs are all clustered very close to the centre of Sydney.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  
top_syd <- data %>%
    filter(year == 2019) %>%
    filter(gccsa_name == "Greater Sydney") %>% 
    arrange(desc(top)) %>%
    head(10)
  
  top_syd_points <- centroid %>%
    semi_join(top_syd) %>%
    mutate(x = st_coordinates(geometry)[,1],
           y = st_coordinates(geometry)[,2])  

ggplot(sydney) +
    geom_sf() +
    geom_sf(data = sydney %>% filter(sa4_name %in% c("Central Coast",
                                                   "Sydney - Eastern Suburbs",
                                                   "Sydney - North Sydney and Hornsby",
                                                   "Sydney - Northern Beaches")),
            mapping = aes(fill = sa4_name)) +
    geom_point(data = top_syd_points,mapping = aes(x,y), colour = "red") +
    geom_label_repel(data = top_syd_points,
                    mapping = aes(x,y,label = suburb_name),
                    direction = "both", size= 2.5, segment.alpha = 0.4) +
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    ggtitle("Top 10 - Greater Sydney (Locations)") +
    labs(fill = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom",
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    guides(fill=guide_legend(nrow=2,byrow=TRUE))
```

Zooming in shows a couple of interesting stories. Being close to Sydney on the Northwest line seems to matter, while places like Darling Point and Double Bay may have benefitted from the lock-out laws in introduced in 2014. Perhaps strangely, only two beach suburbs, Queenscliff and Coogee, feature in the top 10.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}

ggplot(sydney) +
    geom_sf() +
    geom_sf(data = sydney %>% filter(sa4_name %in% c("Central Coast",
                                                     "Sydney - Eastern Suburbs",
                                                     "Sydney - North Sydney and Hornsby",
                                                     "Sydney - Northern Beaches")),
            mapping = aes(fill = sa4_name)) +
    coord_sf(xlim = c(151, 151.4), ylim = c(-34, -33.7), expand = FALSE) +
    geom_point(data = top_syd_points,mapping = aes(x,y), colour = "red") +
    geom_label_repel(data = top_syd_points,
                     mapping = aes(x,y,label = suburb_name),
                     direction = "both", size= 3, segment.alpha = 0.4) +
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    ggtitle("Top 10 - Greater Sydney (Locations)") +
    labs(fill = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom",
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    guides(fill=guide_legend(nrow=2,byrow=TRUE))
```

## Apartments - Growing in the West

One big caveat to begin the story of apartments is that my data was fairly sparse before 2001. I put this down to the NSW Valuer General's focus expanding slightly from being primarily concerned with property sales on plots of land to being concerned with all property sales. For this reason I've indexed prices to 2001 median values rather than those in the year 2000.

### 1 - A Story of Growth
<br>
The median apartment price across the state in 2001 was $`r units %>% filter(year == 2001) %>% summarise(median = median(unit_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`, which was actually higher than the median house price in 2001, at $`r data %>% filter(year == 2001) %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`. But this just reflects the geographical distribution of apartments in NSW, being primarily in Sydney. Interestingly, it was only a bit below the median house in Sydney in 2001 at $`r data %>% filter(year == 2001) %>% filter(gccsa_name == "Greater Sydney") %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`.

The median return over the next 19 years was `r units %>% filter(year == 2019) %>% summarise(median = median(index)) %>% mutate(median = median -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%, with the absolute worst return being a reduction in the index value to only `r units %>% filter(year == 2019) %>% summarise(min = min(index)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")` in `r units %>% filter(year == 2019) %>% arrange(index) %>% select(suburb_name) %>% head(1)`. On the other hand, the average person who bought an apartment in `r units %>% filter(year == 2019) %>% arrange(desc(index)) %>% select(suburb_name) %>% head(1)`, in Wollongong, saw a growth rate of `r units %>% filter(year == 2019) %>% summarise(max = max(index)) %>% mutate(max = max -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%. 

The below graph, puts the growth in apartment prices on the same scale as that for houses and overlays the RBA Cash Rate movements. As you can see, there is a less obvious trend, although it is still upward.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(units,aes(x = year, y = index, group = suburb_name)) + 
    geom_line(alpha = 0.1) +
    ggtitle("Apartments - A Story of Growth") +
    theme_minimal() +
    theme(plot.title = element_text(hjust=0.5)) +
    geom_hline(yintercept=100, linetype="dashed", color = "red") + 
    scale_y_continuous(breaks = c(100,500,1000), limits = c(0,1500)) + 
    labs(x = "Year", y = "Price Index from year 2001") +
    annotate("rect", xmin=2001.1, xmax=2001.9, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2008.7, xmax=2009.3, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2011.9, xmax=2019, ymin=0, ymax=Inf, alpha=0.1, fill="green") +
    annotate("rect", xmin=2002.4, xmax=2008.3, ymin=0, ymax=Inf, alpha=0.1, fill="red") + 
    annotate("rect", xmin=2009.8, xmax=2010.9, ymin=0, ymax=Inf, alpha=0.1, fill="red")
```

### 2 - Top 10 Suburbs 

While there are apartments throughout the state, I've chosen to focus on Greater Sydney as this is where `r units %>% filter(year == 2019) %>% group_by(gccsa_name) %>% summarise(n=n()) %>% filter(gccsa_name == "Greater Sydney") %>% pull()` of the `r units %>% filter(year == 2019) %>% summarise(n=n()) %>% pull()` suburbs are with sufficient apartment sales every year to calculate the median price.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(units %>% 
           filter(gccsa_name == "Greater Sydney") %>% 
           arrange(desc(top)) %>%
           head(190),
         aes(x = year, y = index, group = suburb_name, colour = sa4_name)) + 
    geom_line() +
    geom_text_repel(data = units %>% 
                      filter(gccsa_name == "Greater Sydney") %>% 
                      arrange(desc(top)) %>%
                      head(190) %>%
                      group_by(suburb_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = suburb_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,500,1000)) +
    ggtitle("Top 10 - Greater Sydney") +
    labs(x = "Year", y = "Price Index from year 2001", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom") + 
    guides(colour = guide_legend(override.aes = list(alpha = 1),
                                 nrow=2,byrow=TRUE))
```

The below maps expands on a really interesting finding, apartment price growth is clustered to the south and west of the city. A complete contrast to the above house price growth. In fact, the only statistical area 4 which has any overlap in top 10 performers is the Central Coast. 

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  
top_syd_unit <- units %>%
    filter(year == 2019) %>%
    filter(gccsa_name == "Greater Sydney") %>% 
    arrange(desc(top)) %>%
    head(10)
  
  top_syd_points_unit <- centroid %>%
    semi_join(top_syd_unit) %>%
    mutate(x = st_coordinates(geometry)[,1],
           y = st_coordinates(geometry)[,2]) 

ggplot(sydney) +
    geom_sf() +
    geom_sf(data = sydney %>% filter(sa4_name %in% c("Central Coast",
                                                     "Sydney - City and Inner South",
                                                     "Sydney - Outer South West",
                                                     "Sydney - Outer West and Blue Mountains",
                                                     "Sydney - Inner West",
                                                     "Sydney - South West")),
            mapping = aes(fill = sa4_name)) +
    geom_point(data = top_syd_points_unit,mapping = aes(x,y), colour = "red") +
    geom_label_repel(data = top_syd_points_unit,
                     mapping = aes(x,y,label = suburb_name),
                     direction = "both", size= 3, segment.alpha = 0.4) +
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    ggtitle("Top 10 Suburbs - Apartments - Greater Sydney") +
    labs(fill = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom",
          axis.title.x=element_blank(),
          axis.title.y=element_blank()) +
    guides(fill=guide_legend(nrow=2,byrow=TRUE))

unit_growth_by_sa4 <- units %>%
    filter(year == 2019) %>%
    group_by(sa4_name,gccsa_name) %>%
    summarise(average = mean(index)) 
  
  unit_sydney_growth <- sydney %>%
    left_join(unit_growth_by_sa4)
  
  ggplot(unit_sydney_growth) +
    geom_sf(mapping = aes(fill = average)) +
    scale_fill_continuous(type = "viridis",limits = c(200,350)) +
    ggtitle("Average Price Index - Greater Sydney") +
    labs(fill = "Average Price Index in 2019") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom", legend.key.width = unit(0.7,"cm"))
```

### 3 - Getting Rich off the Lock-Out?

Earlier I touched on the lock-out laws potentially having an impact on house prices to the east of the city. In fact, any change is more likely to be seen in the value of apartments as they make up more than 80% of the properties in the affected areas.

The below graph shows the 9 suburbs where lockout laws are in place and illustrates the February 2014 introduction as a dashed red line. Based on this graph, it very much appears as though the lockout laws had a positive impact on apartment prices.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(units %>%
           filter(suburb_name %in% c("Pyrmont",
                                     "Ultimo",
                                     "Chippendale",
                                     "Haymarket",
                                     "Surry Hills",
                                     "Elizabeth Bay",
                                     "Rushcutters Bay",
                                     "Darlinghurst",
                                     "Woolloomooloo")), 
         aes(x = year, y = index, group = suburb_name)) + 
    geom_line() +
    geom_text_repel(data = units %>%
                      filter(suburb_name %in% c("Pyrmont",
                                                "Ultimo",
                                                "Chippendale",
                                                "Haymarket",
                                                "Surry Hills",
                                                "Elizabeth Bay",
                                                "Rushcutters Bay",
                                                "Darlinghurst",
                                                "Woolloomooloo")) %>%
                      group_by(suburb_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = suburb_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    geom_vline(xintercept = 2014.15, linetype="dashed", color = "red") +
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,500,1000)) +
    ggtitle("Lockout Impact") +
    labs(x = "Year", y = "Price Index from year 2001", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom") + 
    guides(colour = guide_legend(override.aes = list(alpha = 1),
                                 nrow=2,byrow=TRUE))
```

The below graph dispels that thought however as it shows nothing special at all happening in the Sydney Inner City Statistical Area 3 (SA3) where all of these suburbs reside.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  lockout_agg <- units %>%
    filter(sa4_name %in% c("Sydney - Inner West",
                           "Sydney - City and Inner South",
                           "Sydney - Eastern Suburbs")) %>%
    group_by(sa3_name, year) %>%
    summarise(average_index = mean(index))
    
  
  ggplot(lockout_agg, aes(x = year, y = average_index, group = sa3_name, colour = sa3_name)) + 
    geom_line() +
    geom_text_repel(data = lockout_agg %>% 
                      group_by(sa3_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = sa3_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    geom_vline(xintercept = 2014.15, linetype="dashed", color = "red") +
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,200,300,400,500)) +
    ggtitle("Top 10 - Greater Sydney") +
    labs(x = "Year", y = "Price Index from year 2001", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position = "none")
```
