---
title: "NSW Property - A Case Study"
output:
  html_document:
    toc: true
    toc_float: true
---
```{r echo = FALSE,message =FALSE, warning=FALSE}
library(ggplot2)
library(ggrepel)
library(dplyr)
library(sf)
#library(gridExtra)

data <- readRDS("rmarkdown_data.rds")
sydney <- readRDS("map_sydney.rds")
rest <- readRDS("map_rest.rds")

growth_by_sa4 <- data %>%
    filter(year == 2019) %>%
    group_by(sa4_name,gccsa_name) %>%
    summarise(average = mean(index)) 
```

## A Story of Growth
The overwhelming sentiment in Australia is that investing in property is the perfect investment as it doubles every 7 years while at the same time being the safest investment available. These two features are typically considered to be competing forces and are what the Risk/Return tradeoff characterises. But seemingly, in Australia this tradeoff doesn't apply.

The below case study is based on property data obtained from the NSW Valuer General and incorporates a wealth of additional data from various sources listed on the previous page. 

The top 10 things I've found:
<br>

### 1 - A Story of Growth
<br>
If you were looking at buying property in NSW in the year 2000, you basically couldn't go wrong. Prices weren't outrageous and there hadn't been all that much growth over the proceeding 10 years. Across NSW, the median house price was $`r data %>% filter(year == 2000) %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`. In Sydney, this was a bit higher at $`r data %>% filter(year == 2000) %>% filter(gccsa_name == "Greater Sydney") %>% summarise(median = median(house_median)) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`.

The median return over the next 20 years was `r data %>% filter(year == 2019) %>% summarise(median = median(index)) %>% mutate(median = median -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%, with the absolute worst return being `r data %>% filter(year == 2019) %>% summarise(min = min(index)) %>% mutate(min = min -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`% at `r data %>% filter(year == 2019) %>% arrange(index) %>% select(suburb_name) %>% head(1)`. On the other hand, the average person who bought a house in `r data %>% filter(year == 2019) %>% arrange(desc(index)) %>% select(suburb_name) %>% head(1)`, saw a growth rate of `r data %>% filter(year == 2019) %>% summarise(max = max(index)) %>% mutate(max = max -100) %>% round(0) %>% pull() %>% format(digits = 2, big.mark = ",")`%. 

The below graph shows how much of the state grew solidly between 2001 and 2004, plateaued between 2005 and 2009 and then resumed growth from 2009 with takeoff after 2012. Interestingly, these movements coincide strongly with [RBA Cash Rate](https://www.rba.gov.au/statistics/cash-rate/) reductions (between February 2001 and December 2001 the Cash Rate fell 2%, between September 2008 and April 2009 the Cash Rate fell 4.25% and there has been a slow reduction down to 0.75% since November 2011). I've shown reductions in the Cash Rate (i.e. Expansionary Policy) in green and increases (i.e. Contractionary Policy) in red. 

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data,aes(x = year, y = index, group = suburb_name)) + 
    geom_line(alpha = 0.05) +
    ggtitle("NSW Property - A Story of Growth") +
    theme_minimal() +
    theme(plot.title = element_text(hjust=0.5)) +
    geom_hline(yintercept=100, linetype="dashed", color = "red") + 
    scale_y_continuous(breaks = c(100,500,1000)) + 
    labs(x = "Year", y = "Price Index from year 2000") +
    annotate("rect", xmin=2001.1, xmax=2001.9, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2008.7, xmax=2009.3, ymin=0, ymax=Inf, alpha=0.1, fill="green") + 
    annotate("rect", xmin=2011.9, xmax=2019, ymin=0, ymax=Inf, alpha=0.1, fill="green") +
    annotate("rect", xmin=2002.4, xmax=2008.3, ymin=0, ymax=Inf, alpha=0.1, fill="red") + 
    annotate("rect", xmin=2009.8, xmax=2010.9, ymin=0, ymax=Inf, alpha=0.1, fill="red")
```

### 2 - Regional NSW Grew First
<br>
The prevailing wisdom regarding property prices seems to be that property prices tend to rise fastest in the Australian capital cities, particularly Sydney and Melbourne. While the data sees this over the last 7 years, the story isn't as strong in the first property boom of this millenium. 

The below graph shows the above data, but splits the state into Greater Sydney and the rest of NSW. What is clear is that initially regional areas grow faster and it is only in the later spurt that Sydney catches up and in some areas surpases the regional growth.

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data,aes(x = year, y = index, group = suburb_name, colour = gccsa_name)) + 
      geom_line(alpha = 0.1) +
      scale_y_continuous(breaks = c(100,500,1000)) +
      ggtitle("Regional NSW Moved First") +
      labs(x = "Year", y = "Price Index from year 2000", colour = "Region") +
      theme_minimal()+
      theme(plot.title = element_text(hjust=0.5)) +
      theme(legend.position="bottom") + 
      guides(colour = guide_legend(override.aes = list(alpha = 1)))
```

### 3 - Which Regions Grew the Most?
<br>
The table below shows the average cumulative growth in house prices for all 28 statistical level 4 (SA4) regions of NSW. While the Eastern Suburbs of Sydney are way out ahead of the pack, the average index score for all SA4s has at least doubled from 100 at the start of the year 2000 to over 200 all over the state.

```{r echo = FALSE,message =FALSE, warning=FALSE, fig.width = 3}
  table_1 <- growth_by_sa4 %>%
    rename(SA4 = sa4_name,
           `Average Price Index in 2019` = average,
           `Greater Sydney or Rest of NSW` = gccsa_name) %>%
    arrange(desc(`Average Price Index in 2019`))

  knitr::kable(table_1)
```

Visualising these figures on the map of NSW shows an obvious bias towards coastal regions, but also a slight lull for the coastal regions which are closer to Greater Sydney. This might suggest a preference to either be in the thick of it on Bondi Beach or get away from everything, except the beach. 

```{r echo = FALSE,message =FALSE, warning=FALSE, fig.width=4.2, fig.height=4.2, fig.show = 'hold'}
  rest_growth <- rest %>%
    left_join(growth_by_sa4)
  
  ggplot(rest_growth) +
    geom_sf(mapping = aes(fill = average)) +
    scale_fill_continuous(type = "viridis",limits = c(200,600)) +
    ggtitle("Average Price Index - Rest of NSW") +
    labs(fill = "Average Price Index in 2019") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom", legend.key.width = unit(0.7,"cm"))
  
  sydney_growth <- sydney %>%
    left_join(growth_by_sa4)
  
  ggplot(sydney_growth) +
    geom_sf(mapping = aes(fill = average)) +
    scale_fill_continuous(type = "viridis",limits = c(200,600)) +
    ggtitle("Average Price Index - Greater Sydney") +
    labs(fill = "Average Price Index in 2019") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom", legend.key.width = unit(0.7,"cm"))
  
```

### 4 - Which Suburbs Grew the Most?

Based on the above, 
  

```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(data %>% 
           filter(gccsa_name == "Rest of NSW") %>% 
           arrange(desc(top)) %>%
           head(200),
         aes(x = year, y = index, group = suburb_name, colour = sa4_name)) + 
    geom_line() +
    geom_text_repel(data = data %>% 
                      filter(gccsa_name == "Rest of NSW") %>% 
                      arrange(desc(top)) %>%
                      head(200) %>%
                      group_by(suburb_name) %>%
                      arrange(desc(year)) %>%
                      slice(1),
                    aes(x = year + 0.2, label = suburb_name), 
                    direction = "y",hjust = -0.5, size= 3, segment.alpha = 0.4) + 
    scale_x_continuous(expand = c(0.1,0.1,0.3,0)) +
    scale_y_continuous(breaks = c(100,500,1000)) +
    ggtitle("Top 10 - Rest of NSW") +
    labs(x = "Year", y = "Price Index from year 2000", colour = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom") + 
    guides(colour = guide_legend(override.aes = list(alpha = 1)))
```
The below map shows where these 6 regions are located.
```{r echo = FALSE,message =FALSE, warning=FALSE, out.width = "100%"}
  ggplot(rest) +
    geom_sf() +
    geom_sf(data = rest %>% filter(sa4_name %in% c("Capital Region",
                                                   "Hunter Valley exc Newcastle",
                                                   "Richmond - Tweed",
                                                   "Coffs Harbour - Grafton",
                                                   "Newcastle and Lake Macquarie",
                                                   "Riverina")),
            mapping = aes(fill = sa4_name)) +
    ggtitle("Top 10 - Rest of NSW (Locations)") +
    labs(fill = "SA4") +
    theme_minimal()+
    theme(plot.title = element_text(hjust=0.5)) +
    theme(legend.position="bottom")
```



